// ============================================================================
// Card Mixins
// ============================================================================
// Flexible card component system with theming support.
// Provides structured layouts for headers, bodies, footers, menus, and scores.
//
// @requires sass:map - For map manipulation and merging
// @requires global - For pdz-color() function and theme access
// @requires buttons - For integrated button styling
// ============================================================================

@use "./buttons" as *;
@use "sass:map";
@use "../../styles/global.scss" as *;

// ----------------------------------------------------------------------------
// Card Mixin
// ----------------------------------------------------------------------------

/// Creates a themed card component with header, body, and footer sections.
/// Includes built-in support for menus, scores, and sprite grids.
///
/// @param {String} $style ['menu'] - Theme style (menu, primary, secondary, etc.)
/// @param {Map} $overrides [()] - Map of properties to override defaults
/// @output Complete card styling with nested component support
/// @example scss
///   .my-card {
///     @include pdz-card('primary', (
///       border-radius: var(--pdz-shape-corner-lg),
///       sprites-columns: 8
///     ));
///   }
@mixin pdz-card($style: "menu", $overrides: ()) {
  // Dynamic defaults based on style parameter
  $card-defaults: (
    background: pdz-color(#{$style}-container),
    color: pdz-color(on-#{$style}-container),
    border-color: pdz-color(#{$style}-border),
    header: pdz-color(#{$style}-container-high),
    menu: pdz-color(#{$style}-subtle),
    on-menu: pdz-color(on-#{$style}-container),
    menu-hover: pdz-color(#{$style}-container-hover),
    border-radius: var(--pdz-shape-corner-md),
    border-width: 1px,
    border-style: solid,
    header-padding: var(--pdz-space-sm) var(--pdz-space-sm),
    body-padding: var(--pdz-space-sm) var(--pdz-space-md),
    footer-padding: var(--pdz-space-xs) var(--pdz-space-md),
    menu-item-font-size: 1rem,
    menu-item-padding: var(--pdz-space-md),
    menu-width: null,
    sprites-columns: 6,
    sprites-min-size: 36px,
    sprites-gap: var(--pdz-space-sm),
  );

  $config: map.merge($card-defaults, $overrides);

  // Base card styling
  background-color: map.get($config, "background");
  color: map.get($config, "color");
  border-radius: map.get($config, "border-radius");
  border-width: map.get($config, "border-width");
  border-color: map.get($config, "border-color");
  border-style: map.get($config, "border-style");
  display: flex;
  flex-direction: column;
  height: 100%;

  // ----------------------------------------------------------------------------
  // Card Header
  // ----------------------------------------------------------------------------

  .card-header {
    border-radius: map.get($config, "border-radius")
      map.get($config, "border-radius") 0 0;
    background-color: map.get($config, "header");
    display: flex;
    gap: map.get($config, "header-padding");
    justify-content: space-between;
    align-items: center;
    padding: map.get($config, "header-padding");
    min-height: 3.5rem;
    .more-btn {
      @include icon-button(());
    }

    .card-title {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      font-weight: bold;
    }

    .card-score {
      padding: var(--pdz-space-2xs) var(--pdz-space-sm);
      align-self: stretch;
      display: flex;
      align-items: center;
      border-radius: var(--pdz-shape-corner-sm);
      font-size: 0.8rem;
      line-height: 0.9rem;
      font-weight: bold;
      justify-content: center;
      text-align: center;

      // Score variants
      &.pdz-background-neg {
        background-color: pdz-color(negative);
        color: pdz-color(on-negative);
        box-shadow: var(--pdz-level-1);
      }

      &.pdz-background-pos {
        background-color: pdz-color(positive);
        color: pdz-color(on-positive);
        box-shadow: var(--pdz-level-1);
      }

      &.pdz-background-neut {
        background-color: pdz-color(menu-container);
        color: pdz-color(on-menu-container);
      }
    }
  }

  // ----------------------------------------------------------------------------
  // Card Menu
  // ----------------------------------------------------------------------------

  .card-menu {
    position: relative;

    .menu-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background-color: map.get($config, "menu");
      color: map.get($config, "on-menu");
      border-radius: var(--pdz-shape-corner-sm);
      box-shadow: var(--pdz-level-2);
      z-index: 10;
      width: map.get($config, "menu-width");
      padding: var(--pdz-space-sm) 0;
      display: flex;
      flex-direction: column;

      .menu-item {
        display: flex;
        align-items: center;
        gap: var(--pdz-space-md);
        padding: map.get($config, "menu-item-padding");
        background: none;
        border: none;
        width: 100%;
        cursor: pointer;
        font-size: map.get($config, "menu-item-font-size");
        text-wrap: nowrap;
        color: inherit;
        text-align: left;

        &:hover {
          background-color: map.get($config, "menu-hover");
        }

        &:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }
      }
    }
  }

  // ----------------------------------------------------------------------------
  // Card Body
  // ----------------------------------------------------------------------------

  .card-body {
    padding: map.get($config, "body-padding");
    flex-grow: 1;
    overflow: auto;

    .body-header {
      font-size: var(--pdz-font-size-sm);
      color: pdz-color(on-primary-container);
      margin-bottom: var(--pdz-space-xs);
    }

    // Sprite grid layout
    .sprites {
      display: grid;
      grid-template-columns: repeat(
        map.get($config, "sprites-columns"),
        minmax(map.get($config, "sprites-min-size"), 1fr)
      );
      gap: map.get($config, "sprites-gap");
    }
  }

  // ----------------------------------------------------------------------------
  // Card Footer
  // ----------------------------------------------------------------------------

  .card-footer {
    padding: map.get($config, "footer-padding");
    border-top: map.get($config, "border-width")
      map.get($config, "border-style") map.get($config, "border-color");
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: var(--pdz-space-2xs);
    flex-shrink: 0;

    .footer-link {
      @include flat-button(
        (
          padding: var(--pdz-space-xs) var(--pdz-space-md),
          border-radius: var(--pdz-shape-corner-sm),
          background-hover: map.get($config, "footer-link-hover"),
          border: none,
        )
      );
    }
  }
}
