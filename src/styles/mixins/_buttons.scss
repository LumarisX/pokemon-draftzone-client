@use "../../styles/global.scss" as *;
@use "sass:map";

@function create-themed-button-map($theme-color: "primary") {
  @return (
    background: pdz-color("#{$theme-color}-container"),
    background-hover: pdz-color("#{$theme-color}-container-hover"),
    background-selected: pdz-color("#{$theme-color}-container-high"),
    border-width: 1px,
    border-color: pdz-color("#{$theme-color}-border"),
    color: pdz-color(on-surface)
  );
}

$button-primary-defaults: create-themed-button-map("primary");
$button-secondary-defaults: create-themed-button-map("secondary");
$button-menu-defaults: create-themed-button-map("menu");

$base-button-defaults: (
  padding: 0,
  font-size: 1rem,
  gap: var(--pdz-space-xs),
  background: transparent,
  border-width: 0px,
  border-style: solid,
  border-color: pdz-color(outline),
  box-shadow-hover: var(--pdz-level-1),
  opacity-disabled: 0.6,
  cursor-disabled: not-allowed,
  cursor: pointer,
  transition: all 0.2s ease-in-out,
);

@mixin base-button($overrides: ()) {
  $config: map.merge($base-button-defaults, $overrides);

  display: inline-flex;
  align-items: center;
  justify-content: center;

  height: map.get($config, "height");
  width: map.get($config, "width");
  min-width: map.get($config, "min-width");
  max-width: map.get($config, "max-width");
  min-height: map.get($config, "min-height");
  max-height: map.get($config, "max-height");
  padding: map.get($config, "padding");
  gap: map.get($config, "gap");
  font-size: map.get($config, "font-size");
  font-family: map.get($config, "font-family");
  font-weight: map.get($config, "font-weight");
  background-color: map.get($config, "background");
  color: map.get($config, "color");
  border-radius: map.get($config, "border-radius");
  border-width: map.get($config, "border-width");
  border-style: map.get($config, "border-style");
  border-color: map.get($config, "border-color");
  border: map.get($config, "border");

  cursor: map.get($config, "cursor");
  transition: map.get($config, "transition");
  text-decoration: none;
  white-space: nowrap;

  &.selected {
    background-color: map.get($config, "background-selected");
  }
  &:not(:disabled):not(.disabled):hover {
    background-color: map.get($config, "background-hover");
    color: map.get($config, "color-hover");
    border-color: map.get($config, "border-color-hover");
    box-shadow: map.get($config, "box-shadow-hover");
  }

  &:active {
    background-color: map.get($config, "background-active");
    color: map.get($config, "color-active");
  }

  &:disabled,
  &.disabled {
    opacity: map.get($config, "opacity-disabled");
    cursor: map.get($config, "cursor-disabled");
  }
}

$flat-button-defaults: (
  padding: var(--pdz-space-xs) var(--pdz-space-xl),
  border-radius: var(--pdz-shape-corner-sm),
  background: transparent,
  background-hover: none,
  border-color: transparent,
);

@mixin flat-button($overrides: ()) {
  $config: map.merge($flat-button-defaults, $overrides);
  @include base-button($config);
}

@mixin flat-button-menu($overrides: ()) {
  $config: map.merge($button-menu-defaults, $overrides);
  @include flat-button($config);
}

@mixin flat-button-primary($overrides: ()) {
  $config: map.merge($button-primary-defaults, $overrides);
  @include flat-button($config);
}

@mixin flat-button-secondary($overrides: ()) {
  $config: map.merge($button-secondary-defaults, $overrides);
  @include flat-button($config);
}

$icon-button-defaults: (
  padding: var(--pdz-space-xs),
  border-radius: var(--pdz-shape-corner-sm),
  width: 2.5rem,
  height: 2.5rem,
  background: transparent,
  background-hover: none,
  border-color: transparent,
);

@mixin icon-button($overrides: ()) {
  $config: map.merge($icon-button-defaults, $overrides);
  @include base-button($config);
}

@mixin icon-button-primary($overrides: ()) {
  $config: map.merge($button-primary-defaults, $overrides);
  @include icon-button($config);
}

@mixin icon-button-secondary($overrides: ()) {
  $config: map.merge($button-secondary-defaults, $overrides);
  @include icon-button($config);
}

@mixin icon-button-menu($overrides: ()) {
  $config: map.merge($button-menu-defaults, $overrides);
  @include icon-button($config);
}

@mixin float-button($overrides: ()) {
  position: sticky;
  bottom: var(--pdz-space-lg);
  margin-left: auto;
  margin-right: var(--pdz-space-lg);
  width: fit-content;
  height: fit-content;
  z-index: 10000;
  overflow: visible;
  mat-icon {
    display: flex;
    width: fit-content;
    height: fit-content;
    max-height: fit-content;
    max-width: fit-content;
    font-size: 2rem;
  }

  button {
    background-color: pdz-color(menu-container);
    padding: var(--pdz-space-md);
    border-radius: var(--pdz-shape-corner-full);
    box-shadow: var(--pdz-level-3);
    border: 1px solid pdz-color(menu-container-low);
    color: pdz-color(on-menu-container);
    transition: all 0.2s ease-in-out;
    &:hover:not(:disabled) {
      box-shadow: var(--pdz-level-4);
      background-color: pdz-color(menu-container-hover);
      border: 1px solid pdz-color(menu-border);
    }

    &:disabled {
      background-color: pdz-color(surface-disabled);
      color: pdz-color(on-surface-disabled);
      border-width: 0;
    }
  }
}

@mixin float-buttons($overrides: ()) {
  position: sticky;
  bottom: var(--pdz-space-lg);
  margin-left: auto;
  margin-right: var(--pdz-space-lg);
  width: fit-content;
  height: fit-content;
  z-index: 10000;
  --radial-radius: 6rem;
  overflow: visible;
  mat-icon {
    display: flex;
    width: fit-content;
    height: fit-content;
    max-height: fit-content;
    max-width: fit-content;
    font-size: 2rem;
  }
  .radial-stack {
    position: relative;
    display: grid;
    place-items: center;
    width: fit-content;
    height: fit-content;
  }

  button {
    background-color: pdz-color(menu-container);
    padding: var(--pdz-space-md);
    border-radius: var(--pdz-shape-corner-full);
    box-shadow: var(--pdz-level-3);
    border: 1px solid pdz-color(menu-container-low);
    color: pdz-color(on-menu-container);
    &:hover:not(:disabled) {
      box-shadow: var(--pdz-level-4);
      background-color: pdz-color(menu-container-hover);
      border: 1px solid pdz-color(menu-container);
    }

    &.open-tools-button {
      position: relative;
      z-index: 2;
    }

    &.tool-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(var(--angle, -90deg)) translate(0)
        rotate(calc(var(--angle, -90deg) * -1)) scale(0.85);
      opacity: 0;
      pointer-events: none;
      will-change: transform, opacity;
      transition:
        transform 220ms ease,
        opacity 180ms ease,
        box-shadow 180ms ease,
        background-color 180ms ease;
    }

    &:disabled {
      background-color: pdz-color(surface-disabled);
      color: pdz-color(on-surface-disabled);
      border-width: 0;
    }
  }

  .radial-stack.open > button.tool-button {
    transform: translate(-50%, -50%) rotate(var(--angle, -90deg))
      translate(var(--radial-radius)) rotate(calc(var(--angle, -90deg) * -1))
      scale(1);
    opacity: 1;
    pointer-events: auto;
  }
  .radial-stack.open > button:nth-of-type(2).tool-button {
    transition-delay: 0ms;
  }
  .radial-stack.open > button:nth-of-type(3).tool-button {
    transition-delay: 40ms;
  }
  .radial-stack.open > button:nth-of-type(4).tool-button {
    transition-delay: 80ms;
  }

  .radial-stack > button:nth-of-type(2).tool-button {
    --angle: -90deg;
  }
  .radial-stack > button:nth-of-type(3).tool-button {
    --angle: -135deg;
  }
  .radial-stack > button:nth-of-type(4).tool-button {
    --angle: -180deg;
  }
}
