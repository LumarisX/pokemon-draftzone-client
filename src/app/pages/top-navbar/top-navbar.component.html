<header>
  <mat-toolbar mat-density="-2">
    <div class="block md:hidden">
      <button mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon
          matBadge="1"
          matBadgeSize="small"
          matBadgeOverlap="false"
          [matBadgeHidden]="!(anyBadge$ | async)"
          >menu</mat-icon
        >
      </button>
    </div>

    <mat-menu #menu="matMenu">
      @for (tab of TABS; track $index) {
        <button
          mat-menu-item
          [routerLink]="tab.route"
          [matBadge]="tab.badge | async"
          [matBadgeHidden]="!tab.badge || (tab.badge | async) === ''"
        >
          <span>{{ tab.title }}</span>
        </button>
      }
      <button mat-menu-item [matMenuTriggerFor]="toolsMenu">
        <span>Other Tools</span>
      </button>
    </mat-menu>
    <mat-menu #toolsMenu="matMenu">
      <button mat-menu-item routerLink="/tools/quick-matchup">
        <mat-icon>bolt</mat-icon>
        <span> Quick Matchup </span>
      </button>
      <button mat-menu-item routerLink="/tools/time-converter">
        <mat-icon>calendar_clock</mat-icon>
        <span> Time Converter </span>
      </button>
      <button mat-menu-item routerLink="/tools/pokemon-search">
        <mat-icon>search</mat-icon>
        <span> Pokemon Search </span>
      </button>
    </mat-menu>
    <button
      class="home-btn"
      routerLink="/"
      matBadge="1"
      matBadgeSize="small"
      matBadgeOverlap="false"
      [matBadgeHidden]="!(newsBadge | async)"
    >
      <pdz-icon name="logo"></pdz-icon>
    </button>
    <div class="tab-container hidden md:flex">
      @for (tab of TABS; track $index) {
        <button
          class="menu-tab"
          [routerLink]="tab.route"
          [matBadge]="tab.badge | async"
          [matBadgeHidden]="!tab.badge || (tab.badge | async) === ''"
        >
          <span>{{ tab.title }}</span>
        </button>
      }
      <button class="menu-tab" [matMenuTriggerFor]="toolsMenu">
        <span>Other Tools</span>
      </button>
    </div>
    <span class="toolbar-spacer"></span>
    <!-- {{ auth.state$ | async | json }} -->
    @let user = auth.user$ | async;
    <div class="flex flex-col items-center justify-center h-full">
      @if (authenticated && user) {
        <button mat-stroked-button [matMenuTriggerFor]="userMenu">
          <div class="user-info-container">
            <img class="user-icon" src="{{ user.picture }}" />
            @if (user.username && user.username !== "") {
              <span class="username-text">{{ user.username }}</span>
            }
          </div>
        </button>
        <mat-menu #userMenu="matMenu">
          <button
            mat-menu-item
            cdkOverlayOrigin
            #trigger="cdkOverlayOrigin"
            (click)="settingsOpen = !settingsOpen"
          >
            <mat-icon>settings</mat-icon>
            <span>Settings</span>
          </button>
          <ng-template
            cdkConnectedOverlay
            [cdkConnectedOverlayOrigin]="trigger"
            [cdkConnectedOverlayOpen]="settingsOpen"
            (overlayOutsideClick)="settingsOpen = false"
            (detach)="settingsOpen = false"
            [cdkConnectedOverlayFlexibleDimensions]="true"
            [cdkConnectedOverlayPush]="true"
            [cdkConnectedOverlayHasBackdrop]="true"
          >
            <settings (closeSettings)="settingsOpen = false"></settings>
          </ng-template>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Log Out</span>
          </button>
        </mat-menu>
      } @else {
        <button mat-stroked-button (click)="login()">
          <span>Log in</span> <mat-icon>login</mat-icon>
        </button>
      }
    </div>
  </mat-toolbar>
</header>
