<div class="page-header">
  <h1 class="page-header__title">Open Leagues</h1>
  <div class="page-header__actions">
    <button routerLink="manage/new" class="add-button">
      <mat-icon>add</mat-icon>
    </button>
    <button routerLink="manage" class="manage-button">My League Ads</button>
  </div>
</div>

<div class="toolbar">
  <div class="toolbar__results">
    @if (filteredLeagues) {
      Results: {{ filteredLeagues.length }}
    }
  </div>
  <div class="toolbar__controls">
    <!-- Filter Button -->
    <div class="menu-trigger">
      <mat-icon (click)="toggleMenu('filter', $event)">filter_list</mat-icon>
      @if (menu === "filter") {
        <div class="dropdown" (click)="$event.stopPropagation()">
          <h3 class="dropdown__title">Filter Options</h3>

          <div class="filter-group">
            <label class="filter-group__label">Format</label>
            <select [(ngModel)]="filter.format" class="filter-group__select">
              <option value="">Any</option>
              @for (format of formats; track format) {
                <option [value]="format">{{ format }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-group__label">Ruleset</label>
            <select [(ngModel)]="filter.ruleset" class="filter-group__select">
              <option value="">Any</option>
              @for (ruleset of rulesets; track ruleset) {
                <option [value]="ruleset">{{ ruleset }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-group__label">Platform</label>
            <select [(ngModel)]="filter.platform" class="filter-group__select">
              <option value="">Any</option>
              <option value="Pokémon Showdown">Pokémon Showdown</option>
              <option value="Scarlet/Violet">Scarlet/Violet</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-group__label">Skill Level</label>
            <select
              [(ngModel)]="filter.skillLevel"
              class="filter-group__select"
            >
              <option value="any">Any</option>
              <option value="0">Amateur</option>
              <option value="1">Intermediate</option>
              <option value="2">Advanced</option>
              <option value="3">Expert</option>
            </select>
          </div>

          <div class="dropdown-actions">
            <button (click)="applyFilters()" class="apply-button">Apply</button>
            <button (click)="clearFilters()" class="clear-button">Clear</button>
          </div>
        </div>
      }
    </div>

    <!-- Sort Options -->
    <div class="menu-trigger">
      <mat-icon (click)="toggleMenu('sort', $event)">sort</mat-icon>
      @if (menu === "sort") {
        <div class="dropdown" (click)="$event.stopPropagation()">
          <div class="filter-group">
            <label class="filter-group__label">Sort</label>
            <select [(ngModel)]="sortOption" class="sort-select">
              <option value="createdAt">Created At</option>
              <option value="closesAt">Closes At</option>
            </select>
          </div>
        </div>
      }
    </div>
  </div>
</div>

<!-- League Ads Grid -->
@if (filteredLeagues.length) {
  <div class="league-grid">
    @for (league of filteredLeagues; track league; let i = $index) {
      <pdz-league-ad [league]="league" [index]="i"></pdz-league-ad>
    }
  </div>
} @else {
  <div class="empty-state">
    <p class="empty-state__message">
      No leagues looking for players right now. Check back later!
    </p>
  </div>
}
