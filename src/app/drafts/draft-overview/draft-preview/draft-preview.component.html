<div class="drafts-container">
  <div class="header">
    <h1 class="title">My Drafts</h1>
    <div class="actions">
      <button [routerLink]="['/', draftPath, 'new']">
        <mat-icon>add</mat-icon>
      </button>
      <button [routerLink]="['/', draftPath, 'archives']">
        <mat-icon>inventory_2</mat-icon>
      </button>
    </div>
  </div>

  @if (!drafts) {
    <pdz-loading></pdz-loading>
  } @else {
    <div class="drafts-grid">
      @for (tournament of tournaments; track tournament.tournamentKey) {
        <div class="draft-card">
          <div class="card-header">
            @if (tournament.score) {
              <div class="card-score" [ngClass]="scoreClass(tournament)">
                {{ scoreString(tournament) }}
              </div>
            }
            <div class="card-title">
              <h2 class="league-name">{{ tournament.tournamentName }}</h2>
            </div>
          </div>
          <div class="card-body">
            <div class="body-header">
              {{ tournament.ruleset }} - {{ tournament.format }}
            </div>
            <div class="sprites">
              @for (pokemon of tournament.draft; track pokemon.name) {
                <pdz-sprite [pokemon]="pokemon"></pdz-sprite>
              }
            </div>
          </div>
          <div class="card-footer">
            <a
              class="footer-link"
              [routerLink]="[
                '/leagues',
                tournament.leagueKey,
                'tournaments',
                tournament.tournamentKey,
                'divisions',
                tournament.divisionKey,
              ]"
              >View Tournament</a
            >
          </div>
        </div>
      }
      @for (draft of drafts; track draft.tournamentId) {
        <div class="draft-card">
          <div class="card-header">
            @if (draft.score) {
              <div class="card-score" [ngClass]="scoreClass(draft)">
                {{ scoreString(draft) }}
              </div>
            }
            <div class="card-title">
              <h2 class="league-name">{{ draft.leagueName }}</h2>
            </div>
            <div class="card-menu">
              <button
                class="more-btn"
                (click)="toggleMenu(draft.tournamentId, $event)"
              >
                <mat-icon>more_vert</mat-icon>
              </button>

              @if (openDropdown === draft.tournamentId) {
                <div class="menu-dropdown">
                  <button
                    class="menu-item"
                    [routerLink]="['edit']"
                    [queryParams]="{ draft: draft.tournamentId | json }"
                  >
                    <mat-icon>edit_document</mat-icon> Edit Team
                  </button>
                  <button
                    class="menu-item"
                    routerLink="/planner"
                    [queryParams]="{ draft: toPlanner(draft) }"
                  >
                    <mat-icon>event_list</mat-icon> Open in Planner
                  </button>
                  <button
                    class="menu-item"
                    (click)="
                      setMenuState(draft.tournamentId, 'confirm-archive')
                    "
                  >
                    <mat-icon>archive</mat-icon> Archive
                  </button>
                  <button
                    class="menu-item"
                    (click)="setMenuState(draft.tournamentId, 'confirm-delete')"
                  >
                    <mat-icon>delete_forever</mat-icon>
                    Delete
                  </button>
                </div>
              }
            </div>
          </div>
          <div class="card-body">
            <div class="body-header">
              {{ draft.ruleset }} - {{ draft.format }}
            </div>
            <div class="sprites">
              @for (pokemon of draft.team; track pokemon.name) {
                <pdz-sprite [pokemon]="pokemon"></pdz-sprite>
              }
            </div>
          </div>
          <div class="card-footer">
            @if (menuState[draft.tournamentId] === "confirm-archive") {
              <div class="confirmation">
                <p>Archive draft?</p>
                <div class="confirmation-buttons">
                  <button
                    class="btn btn-confirm"
                    (click)="archive(draft.tournamentId)"
                  >
                    Yes
                  </button>
                  <button
                    class="btn btn-cancel"
                    (click)="setMenuState(draft.tournamentId, '')"
                  >
                    No
                  </button>
                </div>
              </div>
            } @else if (menuState[draft.tournamentId] === "confirm-delete") {
              <div class="confirmation">
                <p>Delete draft?</p>
                <div class="confirmation-buttons">
                  <button
                    class="btn btn-confirm"
                    (click)="delete(draft.tournamentId)"
                  >
                    Yes
                  </button>
                  <button
                    class="btn btn-cancel"
                    (click)="setMenuState(draft.tournamentId, '')"
                  >
                    No
                  </button>
                </div>
              </div>
            } @else {
              <a
                class="footer-link"
                [routerLink]="['/', draftPath, draft.tournamentId]"
                >Matches</a
              >
              <a
                class="footer-link"
                [routerLink]="[draft.tournamentId, 'stats']"
                >Stats</a
              >
            }
          </div>
        </div>
      }
    </div>
  }
</div>
