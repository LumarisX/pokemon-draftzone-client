<div class="matchup-main">
  <div class="matchup-header">
    <button mat-flat-button [routerLink]="['/', draftPath, leagueId]">
      Back
    </button>
    <div class="details-spacer">
      <div class="details-container">
        @if (matchupData) {
          <div class="detail-container">
            <p class="detail-title">League Name</p>
            <p class="detail-text">
              {{ matchupData.details.leagueName }}
            </p>
          </div>
          <div class="detail-container">
            <p class="detail-title">Stage</p>
            <p class="detail-text">{{ matchupData.details.stage }}</p>
          </div>
          <div class="detail-container">
            <p class="detail-title">Ruleset</p>
            <p class="detail-text">{{ matchupData.details.ruleset }}</p>
          </div>
          <div class="detail-container">
            <p class="detail-title">Format</p>
            <p class="detail-text">{{ matchupData.details.format }}</p>
          </div>
          @if (timeString) {
            <div class="detail-container">
              <p class="detail-title">Game Time</p>
              <p class="detail-text">{{ timeString }}</p>
            </div>
          }
        }
      </div>
    </div>
    @if (matchupData) {
      <button
        mat-flat-button
        (click)="shared = !shared"
        cdkOverlayOrigin
        #shareTrigger="cdkOverlayOrigin"
      >
        Share
      </button>
      <ng-template
        cdkConnectedOverlay
        [cdkConnectedOverlayOrigin]="shareTrigger"
        [cdkConnectedOverlayOpen]="shared"
        (overlayOutsideClick)="shared = false"
        (detach)="shared = false"
        [cdkConnectedOverlayFlexibleDimensions]="true"
        [cdkConnectedOverlayPush]="true"
      >
        <div class="shared-backdrop">
          <div class="shared-container">
            <div class="share-header">
              <div class="share-title">Share your matchup</div>

              <button mat-icon-button (click)="shared = false">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <div class="share-body">
              <div class="url-container">
                <span class="url-text">
                  {{ shareUrl }}
                </span>
                @if (copied) {
                  <button mat-icon-button (click)="copyToClipboard()">
                    <mat-icon>check</mat-icon>
                  </button>
                } @else {
                  <button mat-icon-button (click)="copyToClipboard()">
                    <mat-icon>content_copy</mat-icon>
                  </button>
                }
              </div>
              <div class="matchup-preview-container">
                <div class="details-container">
                  <div class="detail-container">
                    <p class="detail-title">League Name</p>
                    <p class="detail-text">
                      {{ matchupData.details.leagueName }}
                    </p>
                  </div>
                  <div class="detail-container">
                    <p class="detail-title">Stage</p>
                    <p class="detail-text">{{ matchupData.details.stage }}</p>
                  </div>
                  <div class="detail-container">
                    <p class="detail-title">Ruleset</p>
                    <p class="detail-text">{{ matchupData.details.ruleset }}</p>
                  </div>
                  <div class="detail-container">
                    <p class="detail-title">Format</p>
                    <p class="detail-text">{{ matchupData.details.format }}</p>
                  </div>
                </div>
                <div class="name-container">
                  <div class="name-text">
                    {{ matchupData.summary[0].teamName }}
                  </div>
                  <div class="name-text">
                    {{ matchupData.summary[1].teamName }}
                  </div>
                </div>
                <div class="name-container">
                  <div class="name-text">
                    {{ matchupData.summary[0].coach }}
                  </div>
                  <div class="name-text">
                    {{ matchupData.summary[1].coach }}
                  </div>
                </div>
                <div class="flex divide-x-2">
                  <div
                    class="flex flex-row flex-wrap justify-end w-1/2 pr-2 h-fit"
                  >
                    <div
                      class="relative w-1/3 sm:w-1/4"
                      *ngFor="let pokemon of matchupData.summary[0].team"
                    >
                      <sprite [pokemon]="pokemon" [flipped]="true"></sprite>

                      @if (pokemon.capt?.tera) {
                        <mat-icon>copy</mat-icon>
                      }
                      <div
                        class="absolute flex justify-center w-full -bottom-1"
                      >
                        <div
                          class="w-1/2 font-semibold text-center border rounded-full text-2xs sm:text-xs bg-menu-100 border-menu-200"
                        >
                          {{ pokemon.baseStats.spe }}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="flex flex-wrap w-1/2 pl-2 h-fit">
                    <div
                      class="relative w-1/3 sm:w-1/4"
                      *ngFor="let pokemon of matchupData.summary[1].team"
                    >
                      <sprite [pokemon]="pokemon"></sprite>
                      @if (pokemon.capt?.tera) {
                        <mat-icon>copy</mat-icon>
                      }
                      <div
                        class="absolute flex justify-center w-full -bottom-1"
                      >
                        <div
                          class="w-1/2 font-semibold text-center border rounded-full text-2xs sm:text-xs bg-menu-100 border-menu-200"
                        >
                          {{ pokemon.baseStats.spe }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    }
  </div>
  @if (matchupData) {
    <matchup [matchupData]="matchupData"></matchup>
  } @else {
    <loading></loading>
  }
</div>
