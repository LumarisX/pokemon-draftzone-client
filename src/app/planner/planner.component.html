@if (plannerForm) {
  <form
    [formGroup]="plannerForm"
    class="h-full"
    (keydown.enter)="$event.preventDefault()"
  >
    <div formArrayName="drafts" class="flex flex-col h-full">
      <div
        class="flex flex-shrink-0 items-center p-1 space-x-1 border-b-2 overflow-y-clip h-fit bg-menu-200 border-menu-300"
      >
        <div
          class="flex w-full p-0.5 space-x-1 overflow-x-auto scrollbar-hidden"
        >
          @for (draftCtrl of draftArray.controls; track $index) {
            <div
              [ngClass]="{
                'bg-menu-100': $index === selectedDraft,
                'bg-menu-250 hover:bg-menu-150': $index !== selectedDraft,
              }"
              class="flex items-center border rounded border-menu-500 hover:cursor-pointer"
              [formGroupName]="$index"
              (click)="switchDrafts($index)"
            >
              <input
                class="w-28 px-2 py-0.5 font-nasa text-sm rounded bg-inherit text-ellipsis"
                formControlName="draftName"
              />
              <copy-svg
                class="w-4 m-1 hover:m-0.5 hover:w-5"
                (click)="copyToNew($index)"
              ></copy-svg>
              @if (draftArray.controls.length > 1) {
                <trash-svg
                  class="w-4 m-1 hover:m-0.5 hover:w-5"
                  (click)="deletePlan($index)"
                ></trash-svg>
              }
            </div>
          }
          @if (draftSize < 5) {
            <button (click)="addDraft()">
              <div
                class="h-8 p-1 border rounded aspect-square border-menu-500 bg-menu-100 hover:bg-menu-50 hover:cursor-pointer"
              >
                <plus-svg class="stroke-symbolColor-main"></plus-svg>
              </div>
            </button>
          }
        </div>
      </div>
      <div
        [formGroup]="getDraftFormGroup()"
        class="flex min-h-0 overflow-auto h-full divide-x-4 divide-menu-200"
      >
        @if (isLargeScreen) {
          <mat-tab-group mat-stretch-tabs="false" class="w-1/3 flex-grow-0">
            <mat-tab label="Team">
              <planner-team
                [teamArray]="getDraftFormGroup().controls.team"
                [min]="getDraftFormGroup().controls.min.value"
              ></planner-team>
            </mat-tab>
            <mat-tab label="Settings">
              <planner-settings
                [draftFormGroup]="getDraftFormGroup()"
              ></planner-settings>
            </mat-tab>
          </mat-tab-group>
        }
        <mat-tab-group
          mat-stretch-tabs="false"
          class="flex-grow h-full overflow-auto"
          mat-align-tabs="start"
        >
          @if (!isLargeScreen) {
            <mat-tab label="Team">
              <planner-team
                [teamArray]="getDraftFormGroup().controls.team"
                [min]="getDraftFormGroup().controls.min.value"
              ></planner-team>
            </mat-tab>
            <mat-tab label="Settings">
              <planner-settings
                [draftFormGroup]="getDraftFormGroup()"
              ></planner-settings>
            </mat-tab>
          }
          @if (summary) {
            <mat-tab label="Summary">
              <summary class="h-full list-none" [summary]="summary"></summary>
            </mat-tab>
          }
          @if (typechart && recommended) {
            <mat-tab label="Typechart">
              <typechart
                class="h-full max-w-full"
                [typechart]="typechart"
                [recommended]="recommended"
              ></typechart
            ></mat-tab>
          }
          @if (movechart.length) {
            <mat-tab label="Moves">
              <moves
                class="w-full overflow-y-auto"
                [movechart]="movechart"
              ></moves>
            </mat-tab>
          }
          @if (coverage) {
            <mat-tab label="Coverage">
              <planner-coverage
                class="w-full overflow-y-auto"
                [coverage]="coverage"
              ></planner-coverage>
            </mat-tab>
          }
          <mat-tab label="Find">
            <finder-core
              class="h-full min-w-full overflow-y-auto"
              [rulesetId]="
                getDraftFormGroup().controls.ruleset.value || 'Gen9 NatDex'
              "
              [formatId]="
                getDraftFormGroup().controls.format.value || 'Singles'
              "
            ></finder-core>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </form>
} @else {
  <loading></loading>
}

<!-- {{ plannerForm.value | json }} {{ tabSelected | json }} -->
