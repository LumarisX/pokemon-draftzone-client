@if (plannerForm) {
  <form
    [formGroup]="plannerForm"
    class="h-full"
    (keydown.enter)="$event.preventDefault()"
  >
    <div formArrayName="drafts" class="flex flex-col h-full">
      <div class="tab-bar">
        <div class="tab-wrapper scrollbar-hidden">
          @for (draftCtrl of draftArray.controls; track $index) {
            <div
              [ngClass]="{
                alternate: $index !== selectedDraft.value,
              }"
              class="draft-tab tab"
              [formGroupName]="$index"
              (click)="selectedDraft.next($index)"
            >
              <input formControlName="draftName" />
              <mat-icon (click)="copyToNew($index)">content_copy</mat-icon>
              @if (draftArray.controls.length > 1) {
                <mat-icon (click)="deletePlan($index)">delete_forever</mat-icon>
              }
            </div>
          }
        </div>
        @if (draftSize < 5) {
          <button (click)="addDraft()" class="add-tab tab alternate">
            <mat-icon>add</mat-icon>
          </button>
        }
      </div>
      <div
        [formGroup]="draftFormGroup"
        class="flex min-h-0 overflow-auto h-full divide-x-4 divide-menu-300"
      >
        @if (isLargeScreen) {
          <mat-tab-group
            mat-stretch-tabs="false"
            class="w-fit h-full flex-grow-0"
          >
            <mat-tab label="Team">
              <planner-team [draftFormGroup]="draftFormGroup"></planner-team>
            </mat-tab>
            <mat-tab label="Settings">
              <planner-settings
                [draftFormGroup]="draftFormGroup"
              ></planner-settings>
            </mat-tab>
          </mat-tab-group>
        }
        <mat-tab-group
          mat-stretch-tabs="false"
          [(selectedIndex)]="tabIndex"
          class="flex-grow h-full overflow-auto"
          mat-align-tabs="start"
        >
          @if (!isLargeScreen) {
            <mat-tab label="Team">
              <planner-team [draftFormGroup]="draftFormGroup"></planner-team>
            </mat-tab>
            <mat-tab label="Settings">
              <planner-settings
                [draftFormGroup]="draftFormGroup"
              ></planner-settings>
            </mat-tab>
          }
          @if (summary) {
            <mat-tab label="Summary" [tabIndex]="0">
              <summary class="h-full list-none" [summary]="summary"></summary>
            </mat-tab>
          }
          @if (typechart && recommended) {
            <mat-tab label="Typechart">
              <typechart
                class="h-full max-w-full"
                [typechart]="typechart"
                [recommended]="recommended"
              ></typechart
            ></mat-tab>
          }
          @if (movechart.length) {
            <mat-tab label="Moves">
              <moves
                class="w-full overflow-y-auto"
                [movechart]="movechart"
              ></moves>
            </mat-tab>
          }
          @if (coverage) {
            <mat-tab label="Coverage">
              <planner-coverage
                class="w-full overflow-y-auto"
                [coverage]="coverage"
              ></planner-coverage>
            </mat-tab>
          }
          <mat-tab label="Find">
            <finder-core
              class="h-full min-w-full overflow-y-auto"
              [rulesetId]="
                draftFormGroup.controls.ruleset.value || 'Gen9 NatDex'
              "
              [formatId]="draftFormGroup.controls.format.value || 'Singles'"
            ></finder-core>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </form>
} @else {
  <loading></loading>
}

<!-- {{ plannerForm.value | json }} {{ tabSelected | json }} -->
