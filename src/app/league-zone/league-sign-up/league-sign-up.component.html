<button class="back-btn" routerLink=".." type="button">Back</button>
@if (leagueInfo) {
  <form
    [formGroup]="signupForm"
    (ngSubmit)="onSubmit()"
    class="sign-up__container"
  >
    <div class="sign-up__header">
      <div class="sign-up__title">
        {{ leagueInfo.name }}
      </div>
      <img class="sign-up__logo" [src]="getLogoUrl(leagueInfo.logo)" />
    </div>

    <div class="details-section">
      <div class="details-section__header">
        <h2 class="details-section__title">Details</h2>
      </div>
      <div class="details-section__content">
        <table class="details-table">
          <tr>
            <th>Format:</th>
            <td>{{ leagueInfo.format }}</td>
            @if (leagueInfo.draftStart && leagueInfo.draftEnd) {
              <th>Draft Period:</th>
              <td>
                {{ leagueInfo.draftStart | date }} -
                {{ leagueInfo.draftEnd | date }}
              </td>
            }
          </tr>
          <tr>
            <th>Ruleset:</th>
            <td>{{ leagueInfo.ruleset }}</td>
            @if (leagueInfo.draftStart && leagueInfo.draftEnd) {
              <th>Season:</th>
              <td>
                {{ leagueInfo.seasonStart | date }} -
                {{ leagueInfo.seasonEnd | date }}
              </td>
            }
          </tr>
        </table>
      </div>
    </div>

    @if (added) {
      <div class="message-card">
        <h2 class="message-card__title">
          Thank you for signing up for the PDBL
        </h2>
        <p class="message-card__text">
          Complete your registration by joining the PDBL Discord Server:
        </p>
        <a
          target="_blank"
          href="https://discord.gg/FsxXcWFaF6"
          class="discord-btn"
        >
          <img
            src="assets/icons/discord-mark-blue.svg"
            alt="Discord"
            class="discord-btn__icon"
          />
          Join PDBL Discord Server
        </a>
        <p class="message-card__text message-card__text--secondary">
          Consider
          <a
            target="_blank"
            href="https://pokemondraftzone.com/donate"
            class="link"
            >donating</a
          >
          to the winnings pot. (Leave a note that it's for the PBDL)
        </p>
      </div>
    } @else if (closed) {
      <div class="message-card">
        <h2 class="message-card__title">Sign ups for PDBL are now closed.</h2>
        <p class="message-card__text">
          Join the
          <a
            target="_blank"
            href="https://discord.gg/FsxXcWFaF6"
            class="link link--primary"
          >
            PDBL Discord Server
          </a>
          to get notified for the next season!
        </p>
      </div>
    } @else {
      <div class="form-row">
        <div class="form-field">
          <label for="name" class="form-field__label">
            Display Name <span class="required">*</span>
          </label>
          <input
            id="name"
            type="text"
            class="form-field__input"
            placeholder="Deoxys"
            formControlName="name"
          />
          @if (
            signupForm.get("name")?.hasError("required") &&
            signupForm.get("name")?.touched
          ) {
            <span class="form-field__error">Required</span>
          }
        </div>

        <div class="form-field">
          <label for="gameName" class="form-field__label">
            Showdown Name <span class="required">*</span>
          </label>
          <input
            id="gameName"
            type="text"
            class="form-field__input"
            placeholder="Deoxys-II"
            formControlName="gameName"
          />
          @if (
            signupForm.get("gameName")?.hasError("required") &&
            signupForm.get("gameName")?.touched
          ) {
            <span class="form-field__error">Required</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="discordName" class="form-field__label">
            Discord Username <span class="required">*</span>
          </label>
          <input
            id="discordName"
            type="text"
            class="form-field__input"
            placeholder="Deoxys#0386"
            formControlName="discordName"
          />
          @if (
            signupForm.get("discordName")?.hasError("required") &&
            signupForm.get("discordName")?.touched
          ) {
            <span class="form-field__error">Required</span>
          }
        </div>

        <div class="form-field">
          <label for="timezone" class="form-field__label">
            Time Zone <span class="required">*</span>
          </label>
          <select
            id="timezone"
            class="form-field__input"
            formControlName="timezone"
          >
            <option value="" disabled>Select a timezone</option>
            @for (tz of timezones; track $index) {
              <option [value]="tz">{{ tz }}</option>
            }
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="teamName" class="form-field__label">
            Team Name <span class="required">*</span>
          </label>
          <input
            id="teamName"
            type="text"
            class="form-field__input"
            placeholder="The Double Helixes"
            formControlName="teamName"
          />
          @if (
            signupForm.get("teamName")?.hasError("required") &&
            signupForm.get("teamName")?.touched
          ) {
            <span class="form-field__error">Required</span>
          }
        </div>

        <div class="form-field">
          <label class="form-field__label">Team Logo</label>
          <input
            #logoInput
            id="logo"
            type="file"
            class="file-input-hidden"
            accept="image/*"
            (change)="onLogoUpload($event)"
          />
          <button
            type="button"
            class="form-field__input file-input-button"
            (click)="logoInput.click()"
          >
            {{ logoFileName || "Choose File" }}
          </button>
          <span class="form-field__hint"
            >You can submit one later if you need to</span
          >
        </div>
      </div>

      <div class="form-field">
        <label for="experience" class="form-field__label">
          Experience <span class="required">*</span>
        </label>
        <textarea
          id="experience"
          class="form-field__input form-field__input--textarea"
          formControlName="experience"
          maxlength="500"
          rows="4"
          placeholder="How much experience do you have in draft?"
        ></textarea>
        @if (
          signupForm.get("experience")?.hasError("required") &&
          signupForm.get("experience")?.touched
        ) {
          <span class="form-field__error">Required</span>
        }
      </div>

      <div class="form-field">
        <div class="form-field__label">
          Have you dropped from a league before?
        </div>
        <div class="radio-group">
          <label class="radio-label">
            <input
              type="radio"
              name="droppedBefore"
              class="radio-input"
              [value]="true"
              formControlName="droppedBefore"
            />
            <span>Yes</span>
          </label>
          <label class="radio-label">
            <input
              type="radio"
              name="droppedBefore"
              class="radio-input"
              [value]="false"
              formControlName="droppedBefore"
            />
            <span>No</span>
          </label>
        </div>
      </div>

      @if (signupForm.get("droppedBefore")?.value) {
        <div class="form-field">
          <label for="droppedWhy" class="form-field__label">
            Why? <span class="required">*</span>
          </label>
          <textarea
            id="droppedWhy"
            class="form-field__input form-field__input--textarea"
            formControlName="droppedWhy"
            maxlength="500"
            rows="4"
          ></textarea>
          @if (
            signupForm.get("droppedWhy")?.hasError("required") &&
            signupForm.get("droppedWhy")?.touched
          ) {
            <span class="form-field__error">Required</span>
          }
        </div>
      }

      <div class="form-field">
        <label class="checkbox-label">
          <input
            type="checkbox"
            class="checkbox-input"
            formControlName="confirm"
          />
          <span>
            I have read and accept the
            <a
              target="_blank"
              [href]="
                'https://pokemondraftzone.com/leagues/' +
                leagueInfo.tournamentKey +
                '/rules'
              "
              class="link"
              >league rules</a
            >
            and commit to playing for the entire season.
          </span>
        </label>
      </div>

      <button class="submit-btn" type="submit" [disabled]="!signupForm.valid">
        Submit
      </button>
    }
  </form>
} @else {
  <pdz-loading></pdz-loading>
}
