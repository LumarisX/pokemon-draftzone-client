<div class="tier-form" cdkDropListGroup>
  <div class="tier-form-header">
    <div>Move To</div>
    <div class="flex">
      <div>Untiered</div>

      @for (tierGroup of tierGroups; track tierGroup) {
        @for (tier of tierGroup.tiers; track tier) {
          <div>{{ tier.name }}</div>
        }
      }
    </div>
    <div>Search</div>
  </div>
  @if (tierGroups) {
    <div class="tier-main">
      <div class="untiered-container">
        <div class="untiered-header header-label">
          <div class="untiered-label">Untiered</div>
        </div>
        <div
          class="untiers"
          cdkDropList
          [cdkDropListData]="tierGroups[3].tiers[3]"
          (cdkDropListDropped)="drop($event)"
        >
          @for (pokemon of tierGroups[3].tiers[3].pokemon; track pokemon) {
            <div
              cdkDrag
              [cdkDragStartDelay]="500"
              (mousedown)="onMouseDown()"
              (mouseup)="onMouseUp(pokemon)"
              (cdkDragStarted)="onDragStarted()"
              class="tier-entry"
              [ngClass]="{ selected: pokemon.selected }"
            >
              <div *cdkDragPlaceholder class="drag-placeholder"></div>
              <div class="entry-sprite">
                <pdz-sprite [pid]="pokemon.id"></pdz-sprite>
              </div>
              <div class="entry-name">
                {{ pokemon.name }}
              </div>
              <div class="button-container">
                @if (pokemon.orgTier?.length) {
                  <button class="icon-button">
                    <mat-icon (click)="undoMove(pokemon)">undo</mat-icon>
                  </button>
                }
                <button class="icon-button">
                  <mat-icon>edit</mat-icon>
                </button>
              </div>
            </div>
          }
        </div>
      </div>
      <div class="tier-wrapper">
        <div class="tier-container">
          @for (group of tierGroups; track group) {
            <div class="tier-group">
              @if (group.label !== undefined) {
                <div class="tier-group-label header-label">
                  <mat-icon class="drag-icon">drag_indicator</mat-icon>
                  {{ group.label }}
                  <mat-icon class="edit-icon" (click)="editTierGroup(group)"
                    >edit</mat-icon
                  >
                </div>
              }
              <div class="tier-entry-container">
                @for (tier of group.tiers; track tier) {
                  <div
                    class="tier"
                    cdkDropList
                    [cdkDropListData]="tier"
                    (cdkDropListDropped)="drop($event)"
                  >
                    <div class="tier-label header-label">
                      <mat-icon class="drag-icon">drag_indicator</mat-icon>
                      {{ tier.name }}
                      <mat-icon class="edit-icon" (click)="editTier(tier)"
                        >edit</mat-icon
                      >
                    </div>
                    <div class="tier-entries">
                      @for (pokemon of tier.pokemon; track pokemon) {
                        <div
                          cdkDrag
                          matRipple
                          [matRippleCentered]="true"
                          [matRippleRadius]="40"
                          [matRippleDisabled]="false"
                          [cdkDragStartDelay]="500"
                          (mousedown)="onMouseDown()"
                          (mouseup)="onMouseUp(pokemon)"
                          (cdkDragStarted)="onDragStarted()"
                          class="tier-entry"
                          [ngClass]="{
                            selected: pokemon.selected,
                            dragStarted: dragStarted,
                          }"
                        >
                          <div
                            *cdkDragPlaceholder
                            class="drag-placeholder"
                          ></div>
                          <div class="entry-sprite">
                            <pdz-sprite [pid]="pokemon.id"></pdz-sprite>
                          </div>
                          <div class="entry-name">
                            {{ pokemon.name }}
                          </div>
                          <div class="button-container">
                            @if (pokemon.orgTier?.length) {
                              <button class="icon-button">
                                <mat-icon
                                  (click)="
                                    undoMove(pokemon); $event.stopPropagation()
                                  "
                                  >undo</mat-icon
                                >
                              </button>
                            }
                            <button class="icon-button">
                              <mat-icon
                                (click)="
                                  editPokemon(pokemon, tier);
                                  $event.stopPropagation()
                                "
                                >edit</mat-icon
                              >
                            </button>
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                }
                <div class="new-tier">
                  <div class="add-icon">
                    <mat-icon>add</mat-icon>
                  </div>
                </div>
              </div>
            </div>
          }
          <div class="new-tier-group">
            <div class="add-icon">
              <mat-icon>add</mat-icon>
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <loading></loading>
  }
</div>
