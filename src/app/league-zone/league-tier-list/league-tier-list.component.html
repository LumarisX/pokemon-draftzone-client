<div class="flex flex-col max-w-full h-full items-center">
  <div class="h-full flex max-w-full flex-col space-y-2">
    <div class="flex-grow-0 max-w-full flex justify-between">
      <div class="flex items-center space-x-2">
        <div class="md:text-2xl text-xl font-nasa flex flex-grow">
          Tier List
        </div>
        @if (sortedTierGroups()) {
          <div class="flex w-fit items-center flex-wrap">
            <div class="relative inline-block">
              <button
                mat-icon-button
                (click)="menu = menu === 'sort' ? null : 'sort'"
              >
                <mat-icon>sort</mat-icon>
              </button>
              @if (menu === "sort") {
                <div
                  class="absolute left-full top-0 ml-2 bg-page border rounded menu z-50"
                >
                  <mat-radio-group
                    [(ngModel)]="sortBy"
                    class="flex flex-col p-1 pr-2"
                  >
                    @for (option of SortOptions; track $index) {
                      <mat-radio-button [value]="option">
                        {{ option }}
                      </mat-radio-button>
                    }
                  </mat-radio-group>
                </div>
              }
            </div>
            <div class="relative inline-block">
              <button
                mat-icon-button
                (click)="menu = menu === 'filter' ? null : 'filter'"
              >
                <mat-icon>filter_list</mat-icon>
              </button>
              @if (menu === "filter") {
                <div
                  class="absolute left-full top-0 ml-2 bg-page border rounded-lg menu z-50"
                >
                  <div class="apply-wrapper">
                    <button class="applybutton" (click)="applyFilter()">
                      Apply
                    </button>
                  </div>
                  <div class="max-h-96 overflow-y-auto">
                    <mat-checkbox
                      [checked]="selectedTypes().length === types.length"
                      [indeterminate]="
                        selectedTypes().length > 0 &&
                        selectedTypes().length < types.length
                      "
                      (change)="updateFilter($event.checked)"
                    >
                      All
                    </mat-checkbox>
                    <ul>
                      @for (type of types; track $index; let i = $index) {
                        <li>
                          <mat-checkbox
                            [checked]="selectedTypes().includes(type)"
                            (change)="updateFilter($event.checked, i)"
                          >
                            {{ type }}
                          </mat-checkbox>
                        </li>
                      }
                    </ul>
                  </div>
                </div>
              }
            </div>
            @if (divisionNames.length > 2) {
              <div class="relative inline-block">
                <button
                  mat-stroked-button
                  (click)="menu = menu === 'division' ? null : 'division'"
                >
                  Division
                </button>
                @if (menu === "division") {
                  <div
                    class="absolute left-full top-0 ml-2 bg-page border rounded menu z-50"
                  >
                    <mat-radio-group
                      [(ngModel)]="selectedDivision"
                      class="flex flex-col p-1 pr-2"
                    >
                      @for (option of divisionNames; track $index) {
                        <mat-radio-button [value]="option">
                          {{ option }}
                        </mat-radio-button>
                      }
                    </mat-radio-group>
                  </div>
                }
              </div>
            }
            <div class="inline-block">
              <mat-checkbox [(ngModel)]="showDrafted"
                >Show Drafted</mat-checkbox
              >
            </div>
            <div class="search-input-container">
              <mat-icon>search</mat-icon>
              <input
                [(ngModel)]="searchText"
                (ngModelChange)="searchText.set($event)"
              />
              <mat-icon (click)="searchText.set('')">close_small</mat-icon>
            </div>
          </div>
        }
      </div>
    </div>
    <div
      class="max-w-full max-h-full flex-grow overflow-y-auto rounded-lg w-fit"
    >
      @if (sortedTierGroups()) {
        <div class="tier-container">
          <div class="h-fit w-full flex">
            @for (group of sortedTierGroups(); track $index) {
              <div class="tier-group">
                @if (group.label !== undefined) {
                  <div class="tier-group-label">{{ group.label }}</div>
                }
                <div class="tier-entry-container">
                  @for (tier of group.tiers; track $index) {
                    <div class="tier">
                      <div class="tier-label">
                        {{ tier.name }}
                      </div>
                      @for (pokemon of tier.pokemon; track $index) {
                        @if (
                          typeInFilter(pokemon) &&
                          (showDrafted || !isPokemonDrafted(pokemon))
                        ) {
                          <div
                            class="tier-entry"
                            [ngClass]="{
                              drafted:
                                isPokemonDrafted(pokemon) ||
                                tier.name === 'Ban',
                              selected: selectedPokemon === pokemon,
                            }"
                            (click)="selectPokemon(pokemon, tier.name, $event)"
                          >
                            <div class="entry-sprite">
                              <pdz-sprite
                                [pokemon]="pokemon"
                                [tooltipPosition]="null"
                              ></pdz-sprite>
                            </div>
                            <div class="entry-name">
                              {{ pokemon.name }}
                            </div>
                            @if (pokemon.banned) {
                              <mat-icon
                                class="restricted-icon"
                                mat-raised-button
                                #tooltip="matTooltip"
                                [matTooltip]="makeBanString(pokemon.banned)"
                              >
                                warning
                              </mat-icon>
                            }
                          </div>
                        }
                      }
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      } @else {
        <pdz-loading></pdz-loading>
      }

      @if (selectedPokemon) {
        <div
          class="selected-card"
          [class.mobile-view]="isMobile"
          [style.top]="!isMobile ? cardPosition.top : null"
          [style.left]="!isMobile ? cardPosition.left : null"
          [style.transform]="!isMobile ? 'translateY(-50%)' : null"
        >
          <div class="card-header">
            <div class="card-pokemon-name">
              {{ selectedPokemon.name }}
            </div>
            <div class="sprite-wrapper">
              <pdz-sprite
                [pokemon]="selectedPokemon"
                [tooltipPosition]="null"
              ></pdz-sprite>
            </div>
          </div>

          <div class="card-info">
            <div class="type-container">
              @for (type of selectedPokemon.types; track $index) {
                <div
                  class="type-label"
                  [style.background-color]="typeColor(type)"
                >
                  <div class="type-text">
                    {{ type }}
                  </div>
                </div>
              }
            </div>
            <div class="stats-container">
              @for (stat of pokemonStats; track $index) {
                <div class="stat-container">
                  <div class="stat-name">
                    {{ stat[0] | uppercase }}
                  </div>
                  <div class="stat-value">
                    {{ stat[1] }}
                  </div>
                </div>
              }
            </div>
          </div>

          @if (buttonText) {
            <button
              [disabled]="
                isPokemonDrafted(selectedPokemon) ||
                selectedPokemon.tier == 'Ban'
              "
              (click)="emitDraftPokemon()"
            >
              {{ buttonText }}
            </button>
          }
        </div>
      }
    </div>
  </div>
</div>
